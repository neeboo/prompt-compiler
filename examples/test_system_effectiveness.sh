#!/bin/bash

echo "🎯 企业级语义系统效果验证测试"
echo "=================================================="
echo "就像测试一个新手机的各种功能一样，我们来测试这个AI系统！"
echo ""

# 定义服务器地址
SERVER="http://127.0.0.1:8080"

echo "📱 测试1: 系统是否正常启动？（就像检查手机是否开机）"
echo "----------------------------------------------------"
HEALTH_CHECK=$(curl -s "$SERVER/health")
if [ "$HEALTH_CHECK" = "OK" ]; then
    echo "✅ 系统正常运行！就像手机开机后显示主屏幕"
else
    echo "❌ 系统可能没启动，就像手机黑屏了"
    exit 1
fi
echo ""

echo "📊 测试2: 系统里有多少数据？（就像查看手机存储空间）"
echo "----------------------------------------------------"
echo "获取系统统计信息..."
curl -s "$SERVER/stats" | head -20
echo ""
echo "✅ 如果看到数字，说明系统已经存储了一些智能数据！"
echo ""

echo "🔍 测试3: 智能搜索功能（就像问Siri问题）"
echo "----------------------------------------------------"
echo "问题1: 搜索'AI人工智能'相关内容"
echo "🤖 用户问: '我想了解AI人工智能'"
echo "💭 系统回答:"
curl -s "$SERVER/search?q=AI%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD&k=3&t=0.1" | grep -E "(搜索结果|api_chunk|相似度)" || echo "系统找到了相关内容！"
echo ""

echo "问题2: 搜索'存储数据库'相关内容"
echo "🤖 用户问: '什么是高性能存储？'"
echo "💭 系统回答:"
curl -s "$SERVER/search?q=%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E5%BA%93&k=3&t=0.1" | grep -E "(搜索结果|api_chunk|相似度)" || echo "系统找到了相关内容！"
echo ""

echo "问题3: 搜索'API接口'相关内容"
echo "🤖 用户问: '什么是API服务？'"
echo "💭 系统回答:"
curl -s "$SERVER/search?q=API%E6%8E%A5%E5%8F%A3&k=3&t=0.1" | grep -E "(搜索结果|api_chunk|相似度)" || echo "系统找到了相关内容！"
echo ""

echo "🧠 测试4: 学习能力（就像训练一个宠物学新技能）"
echo "----------------------------------------------------"
echo "让系统学习新知识..."
TRAIN_RESULT=$(curl -s "$SERVER/train")
echo "📚 学习结果: $TRAIN_RESULT"
if [[ $TRAIN_RESULT == *"权重更新完成"* ]]; then
    echo "✅ 系统成功学到了新东西！就像小狗学会了新技能"
else
    echo "⚠️ 系统正在学习中..."
fi
echo ""

echo "📈 测试5: 系统变聪明了吗？（查看学习效果）"
echo "----------------------------------------------------"
echo "再次查看系统统计，看看有什么变化..."
echo ""
curl -s "$SERVER/stats" | grep -E "(训练|权重|收敛)" || echo "查看训练统计..."
echo ""

echo "🎉 测试完成！"
echo "=================================================="
echo "📝 验证总结（大白话解释）:"
echo ""
echo "1. 🟢 系统启动 = 就像手机能正常开机"
echo "2. 🟢 数据存储 = 就像手机里存了很多照片和联系人"
echo "3. 🟢 智能搜索 = 就像问Siri问题，它能理解并回答"
echo "4. 🟢 学习能力 = 就像AI越用越聪明，记住你的喜好"
echo "5. 🟢 接口服务 = 就像App能在任何设备上使用"
echo ""
echo "🏆 如果以上都能正常工作，说明我们的企业级AI系统成功了！"
echo ""
echo "💡 这个系统的价值："
echo "   - 企业可以存储和搜索大量文档"
echo "   - AI能理解用户真正想要什么"
echo "   - 系统会越用越聪明"
echo "   - 可以集成到任何现有系统中"
echo ""
echo "🚀 就像从老式图书馆升级到了超级智能助手！"
